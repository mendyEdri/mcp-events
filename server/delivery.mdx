---
title: Delivery Modes
description: Realtime, cron-based, and scheduled event delivery.
---

MCPE supports three delivery modes that determine when and how events reach the client.

## Realtime

Events are delivered immediately as they occur via `events/event` notifications.

```typescript
// Client subscribes with realtime delivery
await client.subscribe({
  filter: { eventTypes: ["github.push"] },
  delivery: { channels: ["realtime"] },
});
```

When the server publishes a matching event, the client receives it instantly:

```json
{
  "method": "events/event",
  "params": {
    "subscriptionId": "sub_123",
    "event": {
      "id": "evt_456",
      "type": "github.push",
      "data": { "repo": "org/repo" },
      "metadata": { "source": "github", "priority": "normal", "timestamp": "..." }
    }
  }
}
```

Best for: alerts, real-time monitoring, interactive agents.

## Cron-Based Batching

Events are aggregated and delivered on a schedule via `events/batch` notifications.

```typescript
// Daily digest at 9am Eastern
await client.subscribe({
  filter: { sources: ["github"] },
  delivery: {
    channels: ["cron"],
    cronSchedule: {
      expression: "0 9 * * *",
      timezone: "America/New_York",
      aggregateEvents: true,
      maxEventsPerDelivery: 100,
    },
  },
});
```

### Cron Schedule Options

```typescript
interface CronSchedule {
  expression: string;              // Standard cron expression
  timezone: string;                // IANA timezone (default: "UTC")
  aggregateEvents: boolean;        // Combine events into batch (default: true)
  maxEventsPerDelivery: number;    // Max events per batch (default: 100)
}
```

### Common Cron Expressions

| Expression | Schedule |
|------------|----------|
| `* * * * *` | Every minute |
| `0 * * * *` | Every hour |
| `0 9 * * *` | Daily at 9:00 AM |
| `0 9 * * 1-5` | Weekdays at 9:00 AM |
| `0 9,17 * * *` | 9:00 AM and 5:00 PM |
| `0 0 * * 0` | Weekly on Sunday |

Events that arrive between cron ticks are queued. At the scheduled time, all queued events are delivered as a batch.

Best for: digests, summaries, non-urgent aggregation.

## Scheduled (One-Time)

Events are batched until a specific time, then delivered once.

```typescript
// Collect events and deliver in 4 hours
await client.subscribe({
  filter: { eventTypes: ["reminder.*"] },
  delivery: {
    channels: ["scheduled"],
    scheduledDelivery: {
      deliverAt: "2025-01-15T14:00:00Z",
      timezone: "America/New_York",
      autoExpire: true,
      description: "4-hour reminder batch",
    },
  },
});
```

### Scheduled Delivery Options

```typescript
interface ScheduledDelivery {
  deliverAt: string;           // ISO 8601 delivery time
  timezone: string;            // IANA timezone (default: "UTC")
  description?: string;        // Human-readable description
  aggregateEvents: boolean;    // Combine into batch (default: true)
  autoExpire: boolean;         // Auto-expire subscription after delivery (default: true)
}
```

When `autoExpire` is `true`, the subscription is automatically removed after delivery and an `events/subscription_expired` notification is sent.

Best for: reminders, deadline-based collection, one-time reports.

## Server-Side Scheduler

The `EventsServer` includes a built-in `EventScheduler` that manages cron and scheduled jobs.

### Monitoring Active Jobs

```typescript
const info = server.getSchedulerInfo();
for (const job of info.activeJobs) {
  console.log(
    `${job.subscriptionId}: ${job.type}, ` +
    `next run: ${job.nextRun}, ` +
    `pending: ${job.pendingEvents} events`
  );
}
```

### Scheduler Lifecycle

- Jobs are created automatically when subscriptions use `cron` or `scheduled` channels
- Cron jobs repeat on schedule until the subscription is removed or expired
- Scheduled jobs fire once and then optionally expire
- All jobs are cleaned up when the server closes

## Combining Delivery Modes

A subscription can specify multiple delivery channels:

```typescript
delivery: {
  channels: ["realtime", "cron"],
  cronSchedule: { expression: "0 9 * * *" },
}
```

This delivers events both in realtime and as a daily batch. The client receives individual `events/event` notifications immediately and a combined `events/batch` at the scheduled time.
