---
title: Event Handlers
description: Bash, webhook, and agent handlers for automatic event processing.
---

Subscriptions can include a `handler` that automatically processes events when they arrive. This enables fire-and-forget patterns where the server handles event processing without the client needing to stay connected.

## Handler Types

```typescript
type EventHandler = BashEventHandler | AgentEventHandler | WebhookEventHandler;
```

## Bash Handler

Execute a shell command when events arrive.

```typescript
await client.subscribe({
  filter: { eventTypes: ["alert.*"], priority: ["critical"] },
  delivery: { channels: ["realtime"] },
  handler: {
    type: "bash",
    command: "notify-send",
    args: ["Critical Alert", "$MCPE_EVENT_TYPE"],
    input: "env",
    timeout: 30000,
  },
});
```

### Options

```typescript
interface BashEventHandler {
  type: "bash";
  command: string;                // Command to execute
  args?: string[];                // Command arguments
  cwd?: string;                   // Working directory
  env?: Record<string, string>;   // Additional environment variables
  input: "stdin" | "env" | "args"; // How to pass event data (default: "stdin")
  timeout: number;                // Execution timeout in ms (default: 30000)
}
```

### Input Modes

| Mode | Behavior |
|------|----------|
| `"stdin"` | Event JSON is piped to the command's stdin |
| `"env"` | Event fields are set as `MCPE_*` environment variables |
| `"args"` | `$MCPE_*` placeholders in `args` are replaced with values |

### Environment Variables

When using `"env"` or `"args"` input mode, these variables are available:

| Variable | Value |
|----------|-------|
| `MCPE_EVENT_ID` | Event ID |
| `MCPE_EVENT_TYPE` | Event type (e.g., `github.push`) |
| `MCPE_EVENT_DATA` | JSON-encoded event data |
| `MCPE_EVENT_SOURCE` | Event source |
| `MCPE_EVENT_PRIORITY` | Event priority |
| `MCPE_EVENT_TIMESTAMP` | Event timestamp |
| `MCPE_SUBSCRIPTION_ID` | Subscription ID |

### Examples

```typescript
// Log events to a file
handler: {
  type: "bash",
  command: "tee",
  args: ["-a", "/var/log/events.jsonl"],
  input: "stdin",
}

// Send desktop notification
handler: {
  type: "bash",
  command: "osascript",
  args: ["-e", 'display notification "$MCPE_EVENT_TYPE" with title "MCPE Alert"'],
  input: "args",
}

// Run a script with event data in env
handler: {
  type: "bash",
  command: "./process-event.sh",
  input: "env",
  cwd: "/opt/scripts",
  timeout: 60000,
}
```

## Webhook Handler

POST events to an HTTP endpoint.

```typescript
await client.subscribe({
  filter: { eventTypes: ["deployment.*"] },
  delivery: { channels: ["realtime"] },
  handler: {
    type: "webhook",
    url: "https://api.example.com/events",
    headers: {
      "Authorization": "Bearer ${WEBHOOK_TOKEN}",
      "Content-Type": "application/json",
    },
    timeout: 10000,
  },
});
```

### Options

```typescript
interface WebhookEventHandler {
  type: "webhook";
  url: string;                       // Endpoint URL (HTTPS recommended)
  headers?: Record<string, string>;  // HTTP headers
  timeout: number;                   // Request timeout in ms (default: 10000)
}
```

The event is sent as the JSON request body:

```json
{
  "subscriptionId": "sub_123",
  "event": {
    "id": "evt_456",
    "type": "deployment.completed",
    "data": { ... },
    "metadata": { ... }
  }
}
```

## Agent Handler

Delegate event processing to an LLM agent.

```typescript
await client.subscribe({
  filter: { sources: ["slack"], eventTypes: ["slack.message"] },
  delivery: { channels: ["realtime"] },
  handler: {
    type: "agent",
    systemPrompt: "Summarize this Slack message and determine if it requires action.",
    model: "claude-3-sonnet",
    tools: ["slack_reply", "create_task"],
    maxTokens: 1024,
  },
});
```

### Options

```typescript
interface AgentEventHandler {
  type: "agent";
  systemPrompt?: string;      // System prompt for the agent
  model?: string;              // LLM model to use
  instructions?: string;      // Additional instructions
  tools?: string[];            // MCP tools the agent can use
  maxTokens?: number;          // Max response tokens
}
```

### Use Cases

- **Triage**: Auto-classify and label incoming issues
- **Summarize**: Generate summaries of event batches
- **Route**: Determine which team should handle an event
- **Respond**: Auto-reply to routine messages

## Combining Handlers with Delivery Modes

Handlers work with all delivery modes:

```typescript
// Cron + webhook: daily batch POST
await client.subscribe({
  filter: { sources: ["github"] },
  delivery: {
    channels: ["cron"],
    cronSchedule: { expression: "0 9 * * *" },
  },
  handler: {
    type: "webhook",
    url: "https://api.example.com/daily-digest",
  },
});

// Scheduled + agent: process at a specific time
await client.subscribe({
  filter: { eventTypes: ["report.*"] },
  delivery: {
    channels: ["scheduled"],
    scheduledDelivery: { deliverAt: "2025-01-15T17:00:00Z" },
  },
  handler: {
    type: "agent",
    systemPrompt: "Generate an end-of-day report from these events.",
  },
});
```
