---
title: Subscriptions
description: Creating, pausing, resuming, and managing event subscriptions.
---

## Overview

A subscription is the core unit of MCPE. It defines:
- **What** events to receive (filter)
- **How** to deliver them (delivery preferences)
- **What to do** with them (optional handler)

```typescript
interface Subscription {
  id: string;
  clientId: string;
  filter: EventFilter;
  delivery: DeliveryPreferences;
  handler?: EventHandler;
  status: "active" | "paused" | "expired";
  createdAt: string;
  updatedAt: string;
  expiresAt?: string;
}
```

## Creating Subscriptions

Use `events_subscribe` (via `client.subscribe()`) to create a subscription:

```typescript
const sub = await client.subscribe({
  filter: {
    sources: ["github"],
    eventTypes: ["github.push", "github.issue.*"],
    priority: ["high", "critical"],
  },
  delivery: {
    channels: ["realtime"],
  },
});

console.log(sub.subscriptionId); // "550e8400-..."
console.log(sub.status);         // "active"
```

### With a Handler

Subscriptions can include a handler that automatically processes events:

```typescript
const sub = await client.subscribe({
  filter: { eventTypes: ["alert.*"] },
  delivery: { channels: ["realtime"] },
  handler: {
    type: "webhook",
    url: "https://api.example.com/alerts",
    headers: { "Authorization": "Bearer token" },
  },
});
```

### With Expiration

```typescript
const sub = await client.subscribe({
  filter: { sources: ["github"] },
  delivery: { channels: ["realtime"] },
  expiresAt: "2025-02-01T00:00:00Z",
});
```

When a subscription expires, the server sends an `events/subscription_expired` notification.

## Subscription Lifecycle

```
  create
    │
    ▼
┌────────┐   pause    ┌────────┐
│ active │───────────>│ paused │
│        │<───────────│        │
└────────┘   resume   └────────┘
    │                      │
    │  unsubscribe         │  unsubscribe
    ▼                      ▼
┌────────┐            ┌────────┐
│removed │            │removed │
└────────┘            └────────┘

    │ (TTL expires)
    ▼
┌─────────┐
│ expired │
└─────────┘
```

### Pause and Resume

Pausing a subscription stops event delivery without losing the subscription state. This is useful when an agent needs to temporarily stop processing events.

```typescript
// Pause — events are queued but not delivered
await client.pause(sub.subscriptionId);

// Resume — queued events may be delivered
await client.resume(sub.subscriptionId);
```

<Note>
  Whether events that occur during a pause are replayed on resume depends on the server implementation. The reference implementation does not queue events during pause.
</Note>

### Update

Modify a subscription's filter, delivery, or handler without removing it:

```typescript
await client.update(sub.subscriptionId, {
  filter: {
    sources: ["github", "slack"],  // Add slack
    priority: ["critical"],        // Only critical now
  },
});
```

### Unsubscribe

Remove a subscription completely:

```typescript
await client.unsubscribe(sub.subscriptionId);
```

### List Subscriptions

Query active, paused, or expired subscriptions:

```typescript
const result = await client.listSubscriptions("active");
for (const sub of result.subscriptions) {
  console.log(`${sub.id}: ${sub.status}`, sub.filter);
}
```

## Delivery Preferences

Each subscription specifies how events should be delivered:

```typescript
interface DeliveryPreferences {
  channels: DeliveryChannel[];
  cronSchedule?: CronSchedule;
  scheduledDelivery?: ScheduledDelivery;
}

type DeliveryChannel = "realtime" | "cron" | "scheduled";
```

### Realtime

Events are delivered immediately as they occur via `events/event` notifications.

```typescript
delivery: { channels: ["realtime"] }
```

### Cron

Events are aggregated and delivered on a schedule via `events/batch` notifications.

```typescript
delivery: {
  channels: ["cron"],
  cronSchedule: {
    expression: "0 9 * * *",          // Daily at 9am
    timezone: "America/New_York",
    aggregateEvents: true,
    maxEventsPerDelivery: 100,
  },
}
```

### Scheduled

Events are batched until a specific time, then delivered once.

```typescript
delivery: {
  channels: ["scheduled"],
  scheduledDelivery: {
    deliverAt: "2025-01-15T14:00:00Z",
    autoExpire: true,
  },
}
```

See [Delivery](/server/delivery) for more details on delivery modes.

## Server Limits

Servers can enforce limits via capabilities:

- **`maxSubscriptions`** — Maximum subscriptions per client (default: 100)
- **Feature flags** — `pause`, `wildcards`, `cronSchedule`, `scheduledDelivery`

Attempting to exceed limits or use unsupported features returns an error.
