---
title: EventsServer API
sidebarTitle: Server API
description: Complete API reference for the EventsServer class.
---

## Class: EventsServer

Wraps a standard `McpServer` with MCPE event subscription capabilities.

```typescript
import { EventsServer } from "@mcpe/core";
```

### Constructors

```typescript Config Object
new EventsServer(config: EventsServerConfig)
```

```typescript Existing McpServer
new EventsServer(mcpServer: McpServer, options?: EventsServerOptions)
```

---

## Properties

### `mcpServer`

```typescript
readonly mcpServer: McpServer
```

The underlying MCP server instance.

### `subscriptionManager`

```typescript
readonly subscriptionManager: SubscriptionManager
```

Manages subscription CRUD and event matching.

### `handlerExecutor`

```typescript
readonly handlerExecutor: HandlerExecutor
```

Executes event handlers (bash, webhook, agent).

### `scheduler`

```typescript
readonly scheduler: EventScheduler
```

Manages cron and scheduled delivery jobs.

### `capability`

```typescript
get capability(): EventsCapability
```

Returns the resolved events capability object.

---

## Methods

### `publish(event)`

Publish a full event object to all matching subscriptions.

```typescript
async publish(event: MCPEvent): Promise<void>
```

**Parameters:**
| Name | Type | Description |
|------|------|-------------|
| `event` | `MCPEvent` | Complete event with id, type, data, and metadata |

**Example:**
```typescript
await server.publish({
  id: crypto.randomUUID(),
  type: "github.push",
  data: { repo: "org/repo", branch: "main" },
  metadata: {
    source: "github",
    timestamp: new Date().toISOString(),
    priority: "normal",
  },
});
```

### `publish(type, data, metadata)`

Publish an event using shorthand form. ID and timestamp are auto-generated.

```typescript
async publish(
  type: string,
  data: Record<string, unknown>,
  metadata: Omit<EventMetadata, "timestamp"> & { timestamp?: string }
): Promise<void>
```

**Parameters:**
| Name | Type | Description |
|------|------|-------------|
| `type` | `string` | Hierarchical event type (e.g., `"github.push"`) |
| `data` | `Record<string, unknown>` | Event payload |
| `metadata` | `object` | Source, priority, tags. Timestamp is optional. |

**Example:**
```typescript
await server.publish("github.issue.opened", { title: "Bug" }, {
  source: "github",
  priority: "high",
  tags: ["bug"],
});
```

### `sendBatch(events, subscriptionId)`

Send a batch of events to a specific subscription.

```typescript
async sendBatch(events: MCPEvent[], subscriptionId: string): Promise<void>
```

Sends an `events/batch` notification.

### `notifySubscriptionExpired(subscriptionId)`

Notify the client that a subscription has expired.

```typescript
async notifySubscriptionExpired(subscriptionId: string): Promise<void>
```

Sends an `events/subscription_expired` notification.

### `connect(transport)`

Connect the server to an MCP transport.

```typescript
async connect(transport: Transport): Promise<void>
```

### `close()`

Close the server and clean up all resources.

```typescript
async close(): Promise<void>
```

### `isConnected()`

Check if the server is connected to a transport.

```typescript
isConnected(): boolean
```

### `getSchedulerInfo()`

Get information about active scheduled delivery jobs.

```typescript
getSchedulerInfo(): {
  activeJobs: Array<{
    subscriptionId: string;
    type: "cron" | "scheduled";
    nextRun?: Date;
    pendingEvents: number;
  }>;
}
```

---

## Registered Tools

The server automatically registers these MCP tools:

| Tool Name | Purpose |
|-----------|---------|
| `events_subscribe` | Create a new subscription |
| `events_unsubscribe` | Remove a subscription |
| `events_list` | List subscriptions by status |
| `events_pause` | Pause a subscription |
| `events_resume` | Resume a paused subscription |
| `events_update` | Update subscription filter/delivery/handler |

---

## Configuration Types

### EventsServerConfig

```typescript
interface EventsServerConfig {
  name: string;
  version: string;
  events?: EventsServerOptions;
  handlers?: HandlerExecutorConfig;
}
```

### EventsServerOptions

```typescript
interface EventsServerOptions {
  maxSubscriptions?: number;         // Default: 100
  supportedSources?: string[];       // Default: ["github", "gmail", "slack", "custom"]
  deliveryChannels?: string[];       // Default: ["realtime", "cron", "scheduled"]
  features?: Partial<EventsFeatures>;
}
```

### EventsFeatures

```typescript
interface EventsFeatures {
  pause: boolean;              // Default: true
  wildcards: boolean;          // Default: true
  cronSchedule: boolean;       // Default: true
  scheduledDelivery: boolean;  // Default: true
}
```
