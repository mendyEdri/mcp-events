---
title: MCP Integration
description: How to add MCPE events to an existing MCP server.
---

If you already have an MCP server with tools, you can add event subscription capabilities by wrapping it with `EventsServer`.

## Wrapping an Existing McpServer

```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { EventsServer } from "@mcpe/core";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";

// 1. Create your MCP server with existing tools
const mcpServer = new McpServer(
  { name: "my-github-server", version: "1.0.0" },
  { capabilities: {} }
);

// Register your existing MCP tools
mcpServer.tool(
  "github_create_issue",
  {
    title: { type: "string" },
    body: { type: "string" },
    repo: { type: "string" },
  },
  async ({ title, body, repo }) => {
    const issue = await github.createIssue(repo, { title, body });
    return { content: [{ type: "text", text: JSON.stringify(issue) }] };
  }
);

mcpServer.tool(
  "github_add_comment",
  {
    issue: { type: "number" },
    body: { type: "string" },
  },
  async ({ issue, body }) => {
    await github.addComment(issue, body);
    return { content: [{ type: "text", text: "Comment added" }] };
  }
);

// 2. Wrap with EventsServer
const server = new EventsServer(mcpServer, {
  supportedSources: ["github"],
  maxSubscriptions: 50,
  deliveryChannels: ["realtime"],
  features: { pause: true, wildcards: true },
});

// 3. Set up event publishing from your data source
const webhookHandler = express();
webhookHandler.post("/github-webhook", express.json(), (req, res) => {
  const event = req.body;
  server.publish(`github.${event.action}`, event, {
    source: "github",
    priority: "normal",
  });
  res.sendStatus(200);
});

// 4. Connect and serve
await server.connect(new StdioServerTransport());
```

## Combined MCP + MCPE Agent

An agent can use both MCP tools (to act) and MCPE events (to react) through the same connection:

```typescript
import { EventsClient } from "@mcpe/core";
import { StdioClientTransport } from "@modelcontextprotocol/sdk/client/stdio.js";

const client = new EventsClient({ name: "github-agent", version: "1.0.0" });
await client.connect(
  new StdioClientTransport({ command: "node", args: ["./github-server.js"] })
);

// MCP: Create an issue using tools
await client.mcpClient.callTool({
  name: "github_create_issue",
  arguments: { title: "Feature request", body: "...", repo: "org/repo" },
});

// MCPE: Subscribe to reactions on that issue
await client.subscribe({
  filter: {
    sources: ["github"],
    eventTypes: ["github.issue.commented", "github.issue.labeled"],
  },
  delivery: { channels: ["realtime"] },
});

// React to events using MCP tools
client.onEvent("github.issue.commented", async (event) => {
  await client.mcpClient.callTool({
    name: "github_add_comment",
    arguments: {
      issue: event.data.issue_number,
      body: "Thanks for the feedback!",
    },
  });
});
```

## Architecture Pattern

```
┌─────────────────────────────────────────────────────────────┐
│                        Agent                                 │
│                                                              │
│  ┌─────────────┐         ┌──────────────────┐               │
│  │ MCP Client  │         │ EventsClient     │               │
│  │ (tools)     │         │ (subscriptions)  │               │
│  └──────┬──────┘         └────────┬─────────┘               │
│         │                         │                          │
│         └────────┬────────────────┘                          │
│                  │ Same transport                             │
└──────────────────┼───────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────────┐
│                   EventsServer                               │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌───────────────────┐  │
│  │ MCP Tools    │  │ MCPE Tools   │  │ Event Delivery    │  │
│  │ (your tools) │  │ (auto-reg)   │  │ (notifications)   │  │
│  └──────────────┘  └──────────────┘  └───────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## Adding Events to a Resource Server

If your MCP server serves resources, you can add event notifications for resource changes:

```typescript
const mcpServer = new McpServer(
  { name: "file-server", version: "1.0.0" },
  { capabilities: { resources: {} } }
);

// Register resources
mcpServer.resource("file://config.json", async () => {
  return { contents: [{ text: await readFile("config.json", "utf-8") }] };
});

// Wrap with events
const server = new EventsServer(mcpServer, {
  supportedSources: ["custom"],
  deliveryChannels: ["realtime"],
});

// Watch for file changes and publish events
fs.watch("config.json", () => {
  server.publish("custom.file.changed", { path: "config.json" }, {
    source: "custom",
    priority: "normal",
  });
});
```

## Tips

- The `EventsServer` constructor accepts either a config object or an existing `McpServer` — use whichever fits your setup
- MCPE tools are registered alongside your existing tools — they don't conflict
- The agent accesses both regular tools and event tools through the same MCP client
- Use `client.mcpClient` to access the underlying MCP client for tool calls
